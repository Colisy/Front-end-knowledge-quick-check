# 老项目换样式
## 任务描述
>angular老项目，负责后台数据监控，样式经多次更改，没有采用css预处理器。

## 难点
1. 样式类名过长，而且利用覆盖重写，随意使用important，缺乏管理，不易维护。
2. 涉及第三方组件库样式修改。

## 方案
- 通过控制台找到文件，在**原处修改**

  痛点：翻找麻烦，不容易轻易定位影响样式的位置
- **重写样式**，引入less，因为主要颜色只涉及几个，可以使用变量定义颜色，而且嵌套结构更易维护，可以使用嵌套做按钮交互（hover、激活、选中）

## 遇到的问题
- 全局引用的样式，在单个页面引入的less文件修改不生效
- table.css文件修改无效（代码中存在无效文件）
- 样式文件优先级问题，第三方库的样式文件（本地启动不生效，打包部署后生效，而且优先级高，覆盖本地写好的样式,用本地样式加`!important`来解决，类名覆盖有`!important`的权重仍然最高），全局样式，单独页面样式
- 打包部署后 ant-design 的样式文件覆盖本地文件，有发版后样式失效问题出现

## 总结反思
仿真模式生成的类名会自动加上属性，以将样式封装在组件内部，避免影响其他组件。

对于其他三方组件，其内部不会带有该属性，样式不会生效，这就解释了为什么在单独页面样式里无法修改antd组件的样式。

解决方式：

1. 直接将样式写在 **index.html** 中作为全局样式
2. 单独写在一个样式文件中，在 **angular.json** 文件中引入该文件 (采用)
3. **不使用仿真模式**，即不封装该组件的样式，会引入到全局环境中。生成的样式文件中的样式上不会带有 ngcontent 类似的属性选择器
4. 用 angular 提供的 **强制样式浸入子组件** 的功能。:host 代表组件本身，::ng-deep 代表其后的选择器不会带有 ngcontent 属性
```
:host ::ng-deep .MyRect {
  fill: steelblue;
}
```

css权重：

!important>行内样式>ID选择器 > 类选择器 | 属性选择器 | 伪类选择器 > 元素选择器 > 继承

⚠️项目里要考虑文件的权重