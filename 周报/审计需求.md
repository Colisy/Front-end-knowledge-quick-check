# 审计需求

## 需求描述

手机号、身份证号、车牌号等用户信息要做加密处理，查看加密信息要埋点上报。

手头负责的四个项目都要实现审计需求，时间是两周。

## 方案

1. melete 运营平台，用户信息有单独页面查询，其他页面涉及到手机号加密交给前端处理后台不处理。用户信息页面，可以通过标签查询用户相关信息，标签管理加入了安全等级设置，用户权限配置到相应安全等级，才有权限查看用户标签信息。进入用户查询页，要埋点，需要区分搜索进入还是点击进入，还有搜索和点击的信息内容。

2. Alice 风控平台，有 Alice+ 对外开发，nodejs写的 Alice 旧版，vue写的 Alice v2 新版。

    Alice+：入口只有搜索功能，所以只进行埋点。

    Alice 新版：后台将数据加密，前端根据用户权限决定是否开放查看加密数据的按钮。点击按钮请求加密信息并且埋点上报

    Alice 旧版：即将进行迁移，数据加密只交给前端处理。

## 遇到的问题

1. 埋点上报要传用户姓名和用户角色，存在localstorage里不安全，用户可以手动删除localstorage，这样上报信息会缺失用户姓名和角色。所以存在vuex更安全。
2. vuex刷新不清空，导致缓存在vuex中的权限没有更新。
3. 后台传过来的数据带反斜杠，JSON.parse没法处理，导致函数中断，需要抛出异常来解决，处理反斜杠结尾的数据要用任意字符+双引号结束，否则后面代码会失效。
4. 用nodejs做前端项目，直接使用JavaScript写代码。点眼睛，存下整块dom，再装上dom，dom包含的js会重新加载，存在隐患，比如dom切换tab换表格，html不变，js加载的表格去请求默认tab页，导致tab和表格不匹配，而且没法做到表格还是之前的表格