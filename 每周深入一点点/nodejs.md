# nodejs
###### 目的
- 了解后端，与后端人员更好地合作
- 中间层 
- 实现 SSR
- 高并发场景
  
  非阻塞异步I/O，不会像java一样开启新线程

  >一个进程管着多个线程
###### 用处
- nodejs是js运行环境
- 运行在服务器，作为web server
- 运行在本地，作为打包、构建工具
###### 简介
- 事件驱动，依赖于核心模块EventEmitter，是观察者模式（事件监听与触发）主要通过 EventEmitter 的 on 和 emit 这些方法来构成。大多数情况下，我们不会直接使用EventEmitter，而是在对象中继承它，包括fs,http在内的只要是支持事件响应的核心模块都是EventEmitter的子类。
###### 中间层

- 后端给的**数据结构**不是前端想要的，浏览器上做**运算**、做分组、以及一系列操作是一定会影响性能的、尤其数据量很大的情况，所以用中间层对数据进行加工处理
- 同时还可以替后端分担一些简单的逻辑
- 通过node的http基础模块与后端交互，通过http协议与前端通信。
  
###### 后端开发与前端的不同 
- 服务器稳定性 pm2进程守候 自动重启
- 考虑cpu和内存（优化、扩展）steam写日志 redis存session
- 日志记录、存储、分析
- 安全
- 集群和服务拆分
###### RESTful风格API
- 看Url就知道要什么
- 看http method就知道干什么
- 看http status code就知道结果如何
## 数据库
#### redis
内存型数据库

用于登录记录用户信息，信息量不大，访问频繁，忽略断电丢失
>存在本地session变量中的问题：进程所占空间是有限的，可能出现爆栈问题；为了有效利用服务器，和服务的稳定，所以开启了多进程，session数据无法共享。
#### mysql
硬盘型数据库
## express中间件原理
- app.use注册中间件，先收集起来
  
  每个中间件和他匹配的URL放在一个对象里`info = {path:'/',stack:(req,res,next)=>{}}`，再根据注册方式放入all/get/post数组中
- 遇到http请求，通过 method 和 path 判断触发哪些中间件(url包含的子url都会触发)
- 实现next机制，即上一个通过next触发下一个
  
  定义一个next函数，并且手动调用一次，next函数里会从匹配中间件数组里取出一个，并且传入next，然后执行，中间件内部调用next才能继续取出执行，如此反复，直到没有next或数组为空




